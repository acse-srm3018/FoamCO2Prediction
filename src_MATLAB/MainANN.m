%% Start of Program
clc
clear
close all

%% Data Loading
%Data = xlsread('data.xls');
Data =[100	0	0	0	0	42.8	204.10	20.95	17.07	10.35
100	0	0	0	0	54.4	171.20	31.82	29.48	11.00
100	0	0	0	0	57.2	182.60	3.48	31.88	13.79
100	0	0	0	0	34.4	212.56	10.76	16.78	10.00
100	0	0	0	0	71.1	207.90	13.90	4.40	15.52
100	0	0	0	0	32.2	187.77	14.28	10.50	6.90
100	0	0	0	0	40.6	187.77	14.28	10.50	8.28
100	0	0	0	0	57.2	187.77	14.28	10.50	11.86
100	0	0	0	0	48.9	205.10	22.62	12.50	10.59
100	0	0	0	0	118.3	171.10	28.60	34.20	23.45
100	0	0	0	0	67.8	203.81	22.90	31.00	16.90
100	0	0	0	0	110	180.60	35.64	32.51	20.21
100	0	0	0	0	71.1	221.00	6.99	41.27	23.45
100	0	0	0	0	102.2	205.00	9.84	51.28	28.17
100	0	0	0	0	80	240.70	8.60	53.36	26.76
100	0	0	0	0	59	205.00	11.35	5.45	12.80
75	25	0	0	0	40.83	187.8	14.28	10.5	7.53
50	50	0	0	0	40.83	187.8	14.28	10.5	6.55
90	0	10	0	0	40.83	187.8	14.28	10.5	11.04
45	45	10	0	0	40.83	187.8	14.28	10.5	8.83
60	20	20	0	0	40.83	187.8	14.28	10.5	14.07
67.5	23	10	0	0	58.33	187.8	14.28	10.5	12.41
45	45	10	0	0	58.33	187.8	14.28	10.5	10.38
60	20	20	0	0	58.33	187.8	14.28	10.5	17.24
90	0	0	10	0	48.89	187.27	22.82	34.34	10.07
90	0	0	10	0	48.89	187.27	22.82	34.34	9.31
80	0	0	20	0	48.89	187.27	22.82	34.34	9.66
90	0	0	10	0	65.56	187.27	22.82	34.34	13.04
80	0	0	20	0	65.56	187.27	22.82	34.34	10.5
80	0	20	0	0	40.83	187.8	14.28	10.5	14.83
68	22	10	0	0	40.83	187.8	14.28	10.5	10.28
40	40	20	0	0	40.83	187.8	14.28	10.5	12.06
75	25	0	0	0	58.33	187.8	14.28	10.5	10.35
50	50	0	0	0	58.33	187.8	14.28	10.5	8.97
90	0	10	0	0	58.33	187.8	14.28	10.5	15.17
80	0	20	0	0	58.33	187.8	14.28	10.5	18.74
55	25	20	0	0	58.33	187.8	14.28	10.5	16.45
92.5	0	7.5	0	0	54.44	185.83	38.4	5.4	10.35
90	0	10	0	0	54.44	185.83	40.3	29.3	13.1
90.5	0	0	9.5	0	71.11	221	6.99	41.27	18.62
95	0	4.9	0	0.1	71.11	207.9	13.9	4.4	16.83
90	10	0	0	0	60	200	1.31	0	11.6
80	20	0	0	0	60	200	1.31	0	11.4
90.1	0	9.9	0	0	59	205	11.35	5.45	16.01
89.8	0	5.1	0	5.1	59	205	11.35	5.45	20.51
100	0	0	0	0	75.6	53.78	9.03	35.12	23.06
100	0	0	0	0	77.79	64.35	14.38	18.97	21.3
100	0	0	0	0	54.4	185.83	38.4	5.4	9.48
100	0	0	0	0	61.11	185.83	38.4	5.4	10.34
100	0	0	0	0	54.4	185.83	7.5	5	10.34
100	0	0	0	0	54.4	185.83	38.4	22.9	10.34
100	0	0	0	0	54.4	235.56	35.5	5.4	12.75
100	0	0	0	0	57.78	202.61	1.2	0.5	11.72
100	0	0	0	0	37.78	235.56	1.9	4.9	16.54
100	0	0	0	0	67.78	203.81	31.0	22.9	16.89
100	0	0	0	0	112.22	213.5	28.1	32.7	24.14
87.5	0	0	6.2	6.3	76.11	227	6.3	48.6	23.16
79.2	0	0	12	8.8	76.11	227	6.3	48.6	23.16
86.4	0	10.7	2.9	0	73.33	227	6.3	48.6	23.098
92.25	0	0	7.75	0	112.22	213.5	28.1	32.7	19.68
92.5	0	7.5	0	0	54.4	185.83	38.4	5.4	10.34
90	0	10	0	0	54.4	185.83	40.3	29.3	13.1
100	0	0	0	0	32.2	187.8	14.28	10.5	6.8
100	0	0	0	0	40.5	187.8	14.28	10.5	8.27
75	25	0	0	0	40.5	187.8	14.28	10.5	7.53
50	50	0	0	0	40.5	187.8	14.28	10.5	6.53
90	0	10	0	0	40.5	187.8	14.28	10.5	11.07
67.5	22.5	10	0	0	40.5	187.8	14.28	10.5	10.25
45	45	10	0	0	40.5	187.8	14.28	10.5	8.82
80	0	20	0	0	40.5	187.8	14.28	10.5	14.87
60	20	20	0	0	40.5	187.8	14.28	10.5	14.06
40	40	20	0	0	40.5	187.8	14.28	10.5	12.09
100	0	0	0	0	57.22	187.8	14.28	10.5	11.72
75	25	0	0	0	57.22	187.8	14.28	10.5	10.30
50	50	0	0	0	57.22	187.8	14.28	10.5	8.96
90	0	10	0	0	57.22	187.8	14.28	10.5	15.34
67.5	22.5	10	0	0	57.22	187.8	14.28	10.5	12.41
45	45	10	0	0	57.22	187.8	14.28	10.5	10.37
80	0	20	0	0	57.22	187.8	14.28	10.5	18.61
60	20	20	0	0	57.22	187.8	14.28	10.5	17.23
40	40	20	0	0	57.22	187.8	14.28	10.5	12.41
100	0	0	0	0	48.88	187.27	22.82	34.34	11.03
90	0	0	10	0	48.88	187.27	22.82	34.34	9.06
80	0	0	20	0	48.88	187.27	22.82	34.34	8.79
100	0	0	0	0	65.55	187.27	22.82	34.34	13.44
90	0	0	10	0	65.55	187.27	22.82	34.34	11.004
80	0	0	20	0	65.55	187.27	22.82	34.34	11.67
100	0	0	0	0	98.88	190.7	2.95	40.14	30.26
100	0	0	0	0	110	180.6	32.51	35.64	20.20
100	0	0	0	0	71.11	221	6.99	41.27	23.44
95	0	0	5	0	71.11	221	6.99	41.27	18.61
100	0	0	0	0	102.22	205	9.84	51.28	28.16
100	0	0	0	0	80	240.7	8.60	53.36	26.75
100	0	0	0	0	60	183.56	5.81	0	11.24
100	0	0	0	0	80	204.14	2.67	0	15.13
100	0	0	0	0	80	184.1	4.5	0	14.29
75	0	0	0	25	60	184.1	4.5	0	17.13
75	0	0	0	25	70	184.1	4.5	0	18.39
75	0	0	0	25	80	184.1	4.5	0	19.99
80	0	0	0	20	60	184.1	4.5	0	35.42
80	0	0	0	20	70	184.1	4.5	0	36.52
80	0	0	0	20	80	184.1	4.5	0	37.20
100	0	0	0	0	60	463.9	3.7	0	13.09
100	0	0	0	0	80	463.9	3.7	0	14.02
100	0	0	0	0	100	463.9	3.7	0	17.13
100	0	0	0	0	75.6	53.78	14.16	30.19	19.42
100	0	0	0	0	77.79	64.35	18.6	33.09	22.35
100	0	0	0	0	63	51.33	17.31	28.8	21.66
100	0	0	0	0	75.6	53.78	9.03	35.12	22.87
100	0	0	0	0	77.79	64.35	14.38	18.97	20.6];


X = Data(:,1:end-1);
Y = Data(:,end-1:end);

DataNum = size(X,1);
InputNum = size(X,2);
OutputNum = size(Y,2);

%% Normalization
MinX = min(X);
MaxX = max(X);

MinY = min(Y);
MaxY = max(Y);

XN = X;
YN = Y;

for ii = 1:InputNum
    XN(:,ii) = Normalize_Fcn(X(:,ii),MinX(ii),MaxX(ii));
end

for ii = 1:OutputNum
    YN(:,ii) = Normalize_Fcn(Y(:,ii),MinY(ii),MaxY(ii));
end

%% Test and Train Data
TrPercent = 90;
TrNum = round(DataNum * TrPercent / 100);
TsNum = DataNum - TrNum;

R = randperm(DataNum);
trIndex = R(1 : TrNum);
tsIndex = R(1+TrNum : end);

Xtr = XN(trIndex,:);
Ytr = YN(trIndex,:);
Xts = XN(tsIndex,:);
Yts = YN(tsIndex,:);


XTs = X(tsIndex,:);
YTs = Y(tsIndex,:);
XTr = X(trIndex,:);
YTr = Y(trIndex,:);


%% Network Structure
pr = [-1 1];
PR = repmat(pr,InputNum,1);

Network = newff(PR,[42 OutputNum],{'tansig' 'tansig'});

%% Training
Network = train(Network,Xtr',Ytr');

%% Assesment
YtrNet = sim(Network,Xtr')';
YtsNet = sim(Network,Xts')';

MSEtr = mse(YtrNet - Ytr);
MSEts = mse(YtsNet - Yts);

Outputs=Network(XN');

%% Display
figure(1)
plot(Ytr,'-or');
hold on
plot(YtrNet,'-sb');
hold off

figure(2)
plot(Yts,'-or');
hold on
plot(YtsNet,'-sb');
hold off

figure(3)
t = -1:.1:1;
plot(t,t,'b','linewidth',2)
hold on
plot(YTr,YtrNet,'og')
R=corr(YTr,YtrNet);
%title(['R = ' num2str(R)]);
hold off

figure(4)
t = -1:.1:1;
plot(t,t,'b','linewidth',2)
hold on
plot(YTs,YtsNet,'or')
R=corr(YTs,YtsNet);
%title(['R = ' num2str(R)]);
hold off

figure(5)
plot(Y,'-or');
hold on
plot(Outputs,'-sb');
hold off
